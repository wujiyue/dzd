<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC   
    "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.markbro.dzd.base.actionlog.dao.ActionlogMapper">
	<!--<sql id="addColumns">id,yhid,yhmc,uri,params,method,description,result,createTime,actionTime,type,available,deleted</sql> -->
	<!--<sql id="updateColumns">yhid,yhmc,uri,params,method,description,result,actionTime,type,available,deleted</sql> -->
	<cache type="com.markbro.asoiaf.mybatis.cache.AsoiafCache" eviction="org.apache.ibatis.cache.decorators.LruCache" readOnly="true" size="1024" flushInterval="3600000"/>
	<sql id="allColumns">id,yhid,yhmc,uri,params,method,description,result,createTime,actionTime,type,available,deleted</sql>
	<!--如果实体类中属性名与数据库表中的字段名不一致就需要用resultMap映射-->
	<resultMap id="actionlogResult" type="com.markbro.dzd.base.actionlog.bean.Actionlog">
		<result property="id" column="id" />
		<result property="yhid" column="yhid" />
		<result property="yhmc" column="yhmc" />
		<result property="uri" column="uri" />
		<result property="params" column="params" />
		<result property="method" column="method" />
		<result property="description" column="description" />
		<result property="result" column="result" />
		<result property="createTime" column="createTime" />
		<result property="actionTime" column="actionTime" />
		<result property="type" column="type" />
		<result property="available" column="available" />
		<result property="deleted" column="deleted" />
	</resultMap>
    <sql id="Actionlog_Where_Clause">
        <if test="id != null and id != ''">
				AND id = #{id}
		</if>
			<if test="yhid != null and yhid != ''">
				AND yhid = #{yhid}
		</if>
			<if test="yhmc != null and yhmc != ''">
				AND yhmc like concat(concat('%',#{yhmc}),'%')
		</if>
			<if test="uri != null and uri != ''">
				AND uri = #{uri}
		</if>
			<if test="params != null and params != ''">
				AND params = #{params}
		</if>
			<if test="method != null and method != ''">
				AND method = #{method}
		</if>
			<if test="description != null and description != ''">
				AND description = #{description}
		</if>
			<if test="result != null and result != ''">
				AND result = #{result}
		</if>
			<if test="createTime_start != null and createTime_start != ''">
				<![CDATA[   and DATE_FORMAT(createTime, '%Y-%m-%d')>=  DATE_FORMAT(#{createTime_start}, '%Y-%m-%d')   ]]>
		</if>
			<if test="createTime_end != null and createTime_end != ''">
				<![CDATA[   and DATE_FORMAT(createTime, '%Y-%m-%d')<  ADDDATE(DATE_FORMAT(#{createTime_end}, '%Y-%m-%d'),1)   ]]>
		</if>
			<if test="actionTime != null and actionTime != ''">
				AND actionTime = #{actionTime}
		</if>
			<if test="type != null and type != ''">
				AND type = #{type}
		</if>
			<if test="available != null and available != ''">
				AND available = #{available}
		</if>
			<if test="deleted != null and deleted != ''">
				AND deleted = #{deleted}
		</if>
			
    </sql>
    <select id="get"  resultMap="actionlogResult">
        select <include refid="allColumns"/>
        from base_actionlog
        where
        id =#{id}
    </select> 
    <insert id="add" useGeneratedKeys="true" keyProperty="id" parameterType="com.markbro.dzd.base.actionlog.bean.Actionlog" flushCache="true">
    	insert into base_actionlog(id,yhid,yhmc,uri,params,method,description,result,createTime,actionTime,type,available,deleted)
    	values (null,#{yhid},#{yhmc},#{uri},#{params},#{method},#{description},#{result},now(),#{actionTime},#{type},1,0)
    </insert>
    <insert id="addBatch" flushCache="true">
        insert into base_actionlog (id,yhid,yhmc,uri,params,method,description,result,createTime,actionTime,type,available,deleted)
        values
        <foreach collection="list" item="item" separator="," >
        	(null,#{item.yhid},#{item.yhmc},#{item.uri},#{item.params},#{item.method},#{item.description},#{item.result},now(),#{item.actionTime},#{item.type},1,0)
        </foreach>
    </insert>
    <update id="update" parameterType="com.markbro.dzd.base.actionlog.bean.Actionlog" flushCache="true">
    	update base_actionlog 
    	<set>
    		<if test="yhid != null">yhid=#{yhid},</if>
			<if test="yhmc != null">yhmc=#{yhmc},</if>
			<if test="uri != null">uri=#{uri},</if>
			<if test="params != null">params=#{params},</if>
			<if test="method != null">method=#{method},</if>
			<if test="description != null">description=#{description},</if>
			<if test="result != null">result=#{result},</if>
			<if test="actionTime != null">actionTime=#{actionTime},</if>
			<if test="type != null">type=#{type},</if>
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
    	</set>
    	 where
    	id =#{id}
    </update>
	<update id="updateByMap" parameterType="map" flushCache="true">
        update base_actionlog
        <set>
            <if test="yhid != null">yhid=#{yhid},</if>
			<if test="yhmc != null">yhmc=#{yhmc},</if>
			<if test="uri != null">uri=#{uri},</if>
			<if test="params != null">params=#{params},</if>
			<if test="method != null">method=#{method},</if>
			<if test="description != null">description=#{description},</if>
			<if test="result != null">result=#{result},</if>
			<if test="actionTime != null">actionTime=#{actionTime},</if>
			<if test="type != null">type=#{type},</if>
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
        </set>
        where
        id =#{id}
    </update>
	<update id="updateByMapBatch" parameterType="map" flushCache="true">
         update base_actionlog
         <set>
         <if test="yhid != null">yhid=#{yhid},</if>
			<if test="yhmc != null">yhmc=#{yhmc},</if>
			<if test="uri != null">uri=#{uri},</if>
			<if test="params != null">params=#{params},</if>
			<if test="method != null">method=#{method},</if>
			<if test="description != null">description=#{description},</if>
			<if test="result != null">result=#{result},</if>
			<if test="actionTime != null">actionTime=#{actionTime},</if>
			<if test="type != null">type=#{type},</if>
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
         </set>
         where
         id in
         <foreach collection="ids" item = "id" open="(" separator="," close=")">
         #{id}
         </foreach>
    </update>
  	<delete id="delete" flushCache="true">
      	delete  from base_actionlog where id =#{id}
    </delete>
  	<delete id="deleteBatch" flushCache="true">
      	delete  from base_actionlog where id in
        <foreach collection="array" item = "ids" open="(" separator="," close=")">
        #{ids}
        </foreach>
    </delete>
    <select id="find" resultMap="actionlogResult" parameterType="java.util.Map">
        SELECT <include refid="allColumns"/> FROM base_actionlog
        <where>
            and available=1
            and deleted=0
            <include refid="Actionlog_Where_Clause"/>
        </where>
    </select>
    <select id="findByMap" resultMap="actionlogResult"  parameterType="map" >
   		SELECT <include refid="allColumns"/> FROM base_actionlog
   		<where>
   		    <if test="id != null and id != ''">
				AND id = #{id}
			</if>
			<if test="yhid != null and yhid != ''">
				AND yhid = #{yhid}
			</if>
			<if test="yhmc != null and yhmc != ''">
				AND yhmc like concat(concat('%',#{yhmc}),'%')
			 </if>
			<if test="uri != null and uri != ''">
				AND uri = #{uri}
			</if>
			<if test="params != null and params != ''">
				AND params = #{params}
			</if>
			<if test="method != null and method != ''">
				AND method = #{method}
			</if>
			<if test="description != null and description != ''">
				AND description = #{description}
			</if>
			<if test="result != null and result != ''">
				AND result = #{result}
			</if>
			<if test="createTime_start != null and createTime_start != ''">
				<![CDATA[   and DATE_FORMAT(createTime, '%Y-%m-%d')>=  DATE_FORMAT(#{createTime_start}, '%Y-%m-%d')   ]]>
			</if>
			<if test="createTime_end != null and createTime_end != ''">
				<![CDATA[   and DATE_FORMAT(createTime, '%Y-%m-%d')<  ADDDATE(DATE_FORMAT(#{createTime_end}, '%Y-%m-%d'),1)   ]]>
			</if>
			<if test="actionTime != null and actionTime != ''">
				AND actionTime = #{actionTime}
			</if>
			<if test="type != null and type != ''">
				AND type = #{type}
			</if>
			<if test="available != null and available != ''">
				AND available = #{available}
			</if>
			<if test="deleted != null and deleted != ''">
				AND deleted = #{deleted}
			</if>
			
   		</where>
   	</select>

	<select id="findByYhid" resultType="com.markbro.dzd.base.actionlog.bean.Actionlog">
		select *
			from base_actionlog
		<where>
			yhid=#{yhid}
			and deleted=0
			and available=1
		</where>
	</select>
</mapper>
