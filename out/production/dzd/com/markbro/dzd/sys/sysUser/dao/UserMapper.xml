<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC   
    "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.markbro.dzd.sys.sysUser.dao.UserMapper">
	<!--<sql id="addColumns">id,orgid,account,password,usertype,nickname,remark,gender,birthday,age,realname,idcard,hometown,address,qq,email,emailflag,phone,phoneflag,createtype,lastLoginIp,lastLoginTime,openid,createTime,updateTime,available,deleted</sql> -->
	<!--<sql id="updateColumns">orgid,account,password,usertype,nickname,remark,gender,birthday,age,realname,idcard,hometown,address,qq,email,emailflag,phone,phoneflag,createtype,lastLoginIp,lastLoginTime,openid,updateTime,available,deleted</sql> -->
	<cache type="com.markbro.asoiaf.mybatis.cache.AsoiafCache" eviction="org.apache.ibatis.cache.decorators.LruCache" readOnly="true" size="1024" flushInterval="3600000"/>
	<sql id="allColumns">id,orgid,account,password,usertype,nickname,remark,gender,birthday,age,realname,idcard,hometown,address,qq,email,emailflag,phone,phoneflag,createtype,lastLoginIp,lastLoginTime,openid,createTime,updateTime,available,deleted</sql>
	<!--如果实体类中属性名与数据库表中的字段名不一致就需要用resultMap映射-->
	<resultMap id="userResult" type="com.markbro.dzd.sys.sysUser.bean.User">
		<result property="id" column="id" />
		<result property="orgid" column="orgid" />
		<result property="account" column="account" />
		<result property="password" column="password" />
		<result property="usertype" column="usertype" />
		<result property="nickname" column="nickname" />
		<result property="remark" column="remark" />
		<result property="gender" column="gender" />
		<result property="birthday" column="birthday" />
		<result property="age" column="age" />
		<result property="realname" column="realname" />
		<result property="idcard" column="idcard" />
		<result property="hometown" column="hometown" />
		<result property="address" column="address" />
		<result property="qq" column="qq" />
		<result property="email" column="email" />
		<result property="emailflag" column="emailflag" />
		<result property="phone" column="phone" />
		<result property="phoneflag" column="phoneflag" />
		<result property="createtype" column="createtype" />
		<result property="lastLoginIp" column="lastLoginIp" />
		<result property="lastLoginTime" column="lastLoginTime" />
		<result property="openid" column="openid" />
		<result property="createTime" column="createTime" />
		<result property="updateTime" column="updateTime" />
		<result property="available" column="available" />
		<result property="deleted" column="deleted" />
	</resultMap>
    <sql id="User_Where_Clause">
        <if test="id != null and id != ''">
				AND id = #{id}
		</if>
			<if test="orgid != null and orgid != ''">
				AND orgid = #{orgid}
		</if>
			<if test="account != null and account != ''">
				AND account = #{account}
		</if>
			<if test="password != null and password != ''">
				AND password = #{password}
		</if>
			<if test="usertype != null and usertype != ''">
				AND usertype = #{usertype}
		</if>
			<if test="nickname != null and nickname != ''">
				AND nickname = #{nickname}
		</if>
			<if test="remark != null and remark != ''">
				AND remark = #{remark}
		</if>
			<if test="gender != null and gender != ''">
				AND gender = #{gender}
		</if>
			<if test="birthday != null and birthday != ''">
				AND birthday = #{birthday}
		</if>
			<if test="age != null and age != ''">
				AND age = #{age}
		</if>
			<if test="realname != null and realname != ''">
				AND realname = #{realname}
		</if>
			<if test="idcard != null and idcard != ''">
				AND idcard = #{idcard}
		</if>
			<if test="hometown != null and hometown != ''">
				AND hometown = #{hometown}
		</if>
			<if test="address != null and address != ''">
				AND address = #{address}
		</if>
			<if test="qq != null and qq != ''">
				AND qq = #{qq}
		</if>
			<if test="email != null and email != ''">
				AND email = #{email}
		</if>
			<if test="emailflag != null and emailflag != ''">
				AND emailflag = #{emailflag}
		</if>
			<if test="phone != null and phone != ''">
				AND phone = #{phone}
		</if>
			<if test="phoneflag != null and phoneflag != ''">
				AND phoneflag = #{phoneflag}
		</if>
			<if test="createtype != null and createtype != ''">
				AND createtype = #{createtype}
		</if>
			<if test="lastLoginIp != null and lastLoginIp != ''">
				AND lastLoginIp = #{lastLoginIp}
		</if>
			<if test="lastLoginTime != null and lastLoginTime != ''">
				AND lastLoginTime = #{lastLoginTime}
		</if>
			<if test="openid != null and openid != ''">
				AND openid = #{openid}
		</if>
			<if test="createTime != null and createTime != ''">
				AND createTime = #{createTime}
		</if>
			<if test="updateTime != null and updateTime != ''">
				AND updateTime = #{updateTime}
		</if>
			<if test="available != null and available != ''">
				AND available = #{available}
		</if>
			<if test="deleted != null and deleted != ''">
				AND deleted = #{deleted}
		</if>
			
    </sql>
    <select id="get"  resultMap="userResult">
        select <include refid="allColumns"/>
        from sys_user
        where
        id =#{id}
    </select> 
    <insert id="add" useGeneratedKeys="true" keyProperty="id" parameterType="com.markbro.dzd.sys.sysUser.bean.User" flushCache="true">
    	insert into sys_user(id,orgid,account,password,usertype,nickname,remark,gender,birthday,age,realname,idcard,hometown,address,qq,email,emailflag,phone,phoneflag,createtype,lastLoginIp,lastLoginTime,openid,createTime,updateTime,available,deleted)
    	values (#{id},#{orgid},#{account},#{password},#{usertype},#{nickname},#{remark},#{gender},#{birthday},#{age},#{realname},#{idcard},#{hometown},#{address},#{qq},#{email},#{emailflag},#{phone},#{phoneflag},#{createtype},#{lastLoginIp},#{lastLoginTime},#{openid},now(),now(),1,0)
    </insert>
    <insert id="addBatch" flushCache="true">
        insert into sys_user (id,orgid,account,password,usertype,nickname,remark,gender,birthday,age,realname,idcard,hometown,address,qq,email,emailflag,phone,phoneflag,createtype,lastLoginIp,lastLoginTime,openid,createTime,updateTime,available,deleted)
        values
        <foreach collection="list" item="item" separator="," >
        	(#{item.id},#{item.orgid},#{item.account},#{item.password},#{item.usertype},#{item.nickname},#{item.remark},#{item.gender},#{item.birthday},#{item.age},#{item.realname},#{item.idcard},#{item.hometown},#{item.address},#{item.qq},#{item.email},#{item.emailflag},#{item.phone},#{item.phoneflag},#{item.createtype},#{item.lastLoginIp},#{item.lastLoginTime},#{item.openid},now(),now(),1,0)
        </foreach>
    </insert>
    <update id="update" parameterType="com.markbro.dzd.sys.sysUser.bean.User" flushCache="true">
    	update sys_user 
    	<set>
    		<if test="orgid != null">orgid=#{orgid},</if>
			<if test="account != null">account=#{account},</if>
			<if test="password != null">password=#{password},</if>
			<if test="usertype != null">usertype=#{usertype},</if>
			<if test="nickname != null">nickname=#{nickname},</if>
			<if test="remark != null">remark=#{remark},</if>
			<if test="gender != null">gender=#{gender},</if>
			<if test="birthday != null">birthday=#{birthday},</if>
			<if test="age != null">age=#{age},</if>
			<if test="realname != null">realname=#{realname},</if>
			<if test="idcard != null">idcard=#{idcard},</if>
			<if test="hometown != null">hometown=#{hometown},</if>
			<if test="address != null">address=#{address},</if>
			<if test="qq != null">qq=#{qq},</if>
			<if test="email != null">email=#{email},</if>
			<if test="emailflag != null">emailflag=#{emailflag},</if>
			<if test="phone != null">phone=#{phone},</if>
			<if test="phoneflag != null">phoneflag=#{phoneflag},</if>
			<if test="createtype != null">createtype=#{createtype},</if>
			<if test="lastLoginIp != null">lastLoginIp=#{lastLoginIp},</if>
			<if test="lastLoginTime != null">lastLoginTime=#{lastLoginTime},</if>
			<if test="openid != null">openid=#{openid},</if>
			updateTime=now(),
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
    	</set>
    	 where
    	id =#{id}
    </update>
	<update id="updateByMap" parameterType="map" flushCache="true">
        update sys_user
        <set>
            <if test="orgid != null">orgid=#{orgid},</if>
			<if test="account != null">account=#{account},</if>
			<if test="password != null">password=#{password},</if>
			<if test="usertype != null">usertype=#{usertype},</if>
			<if test="nickname != null">nickname=#{nickname},</if>
			<if test="remark != null">remark=#{remark},</if>
			<if test="gender != null">gender=#{gender},</if>
			<if test="birthday != null">birthday=#{birthday},</if>
			<if test="age != null">age=#{age},</if>
			<if test="realname != null">realname=#{realname},</if>
			<if test="idcard != null">idcard=#{idcard},</if>
			<if test="hometown != null">hometown=#{hometown},</if>
			<if test="address != null">address=#{address},</if>
			<if test="qq != null">qq=#{qq},</if>
			<if test="email != null">email=#{email},</if>
			<if test="emailflag != null">emailflag=#{emailflag},</if>
			<if test="phone != null">phone=#{phone},</if>
			<if test="phoneflag != null">phoneflag=#{phoneflag},</if>
			<if test="createtype != null">createtype=#{createtype},</if>
			<if test="lastLoginIp != null">lastLoginIp=#{lastLoginIp},</if>
			<if test="lastLoginTime != null">lastLoginTime=#{lastLoginTime},</if>
			<if test="openid != null">openid=#{openid},</if>
			updateTime=now(),
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
        </set>
        where
        id =#{id}
    </update>
	<update id="updateByMapBatch" parameterType="map" flushCache="true">
         update sys_user
         <set>
         <if test="orgid != null">orgid=#{orgid},</if>
			<if test="account != null">account=#{account},</if>
			<if test="password != null">password=#{password},</if>
			<if test="usertype != null">usertype=#{usertype},</if>
			<if test="nickname != null">nickname=#{nickname},</if>
			<if test="remark != null">remark=#{remark},</if>
			<if test="gender != null">gender=#{gender},</if>
			<if test="birthday != null">birthday=#{birthday},</if>
			<if test="age != null">age=#{age},</if>
			<if test="realname != null">realname=#{realname},</if>
			<if test="idcard != null">idcard=#{idcard},</if>
			<if test="hometown != null">hometown=#{hometown},</if>
			<if test="address != null">address=#{address},</if>
			<if test="qq != null">qq=#{qq},</if>
			<if test="email != null">email=#{email},</if>
			<if test="emailflag != null">emailflag=#{emailflag},</if>
			<if test="phone != null">phone=#{phone},</if>
			<if test="phoneflag != null">phoneflag=#{phoneflag},</if>
			<if test="createtype != null">createtype=#{createtype},</if>
			<if test="lastLoginIp != null">lastLoginIp=#{lastLoginIp},</if>
			<if test="lastLoginTime != null">lastLoginTime=#{lastLoginTime},</if>
			<if test="openid != null">openid=#{openid},</if>
			updateTime=now(),
			<if test="available != null">available=#{available},</if>
			<if test="deleted != null">deleted=#{deleted},</if>
			
         </set>
         where
         id in
         <foreach collection="ids" item = "id" open="(" separator="," close=")">
         #{id}
         </foreach>
    </update>
  	<delete id="delete" flushCache="true">
      	delete  from sys_user where id =#{id}
    </delete>
  	<delete id="deleteBatch" flushCache="true">
      	delete  from sys_user where id in
        <foreach collection="array" item = "ids" open="(" separator="," close=")">
        #{ids}
        </foreach>
    </delete>
    <select id="find" resultMap="userResult" parameterType="java.util.Map">
        SELECT <include refid="allColumns"/> FROM sys_user
        <where>
            and available=1
            and deleted=0
            <include refid="User_Where_Clause"/>
        </where>
    </select>
    <select id="findByMap" resultMap="userResult"  parameterType="map" >
   		SELECT <include refid="allColumns"/> FROM sys_user
   		<where>
   		    <if test="id != null and id != ''">
				AND id = #{id}
			</if>
			<if test="orgid != null and orgid != ''">
				AND orgid = #{orgid}
			</if>
			<if test="account != null and account != ''">
				AND account = #{account}
			</if>
			<if test="password != null and password != ''">
				AND password = #{password}
			</if>
			<if test="usertype != null and usertype != ''">
				AND usertype = #{usertype}
			</if>
			<if test="nickname != null and nickname != ''">
				AND nickname = #{nickname}
			</if>
			<if test="remark != null and remark != ''">
				AND remark = #{remark}
			</if>
			<if test="gender != null and gender != ''">
				AND gender = #{gender}
			</if>
			<if test="birthday != null and birthday != ''">
				AND birthday = #{birthday}
			</if>
			<if test="age != null and age != ''">
				AND age = #{age}
			</if>
			<if test="realname != null and realname != ''">
				AND realname = #{realname}
			</if>
			<if test="idcard != null and idcard != ''">
				AND idcard = #{idcard}
			</if>
			<if test="hometown != null and hometown != ''">
				AND hometown = #{hometown}
			</if>
			<if test="address != null and address != ''">
				AND address = #{address}
			</if>
			<if test="qq != null and qq != ''">
				AND qq = #{qq}
			</if>
			<if test="email != null and email != ''">
				AND email = #{email}
			</if>
			<if test="emailflag != null and emailflag != ''">
				AND emailflag = #{emailflag}
			</if>
			<if test="phone != null and phone != ''">
				AND phone = #{phone}
			</if>
			<if test="phoneflag != null and phoneflag != ''">
				AND phoneflag = #{phoneflag}
			</if>
			<if test="createtype != null and createtype != ''">
				AND createtype = #{createtype}
			</if>
			<if test="lastLoginIp != null and lastLoginIp != ''">
				AND lastLoginIp = #{lastLoginIp}
			</if>
			<if test="lastLoginTime != null and lastLoginTime != ''">
				AND lastLoginTime = #{lastLoginTime}
			</if>
			<if test="openid != null and openid != ''">
				AND openid = #{openid}
			</if>
			<if test="createTime != null and createTime != ''">
				AND createTime = #{createTime}
			</if>
			<if test="updateTime != null and updateTime != ''">
				AND updateTime = #{updateTime}
			</if>
			<if test="available != null and available != ''">
				AND available = #{available}
			</if>
			<if test="deleted != null and deleted != ''">
				AND deleted = #{deleted}
			</if>
			
   		</where>
   	</select>

	<select id="findByOrgid" resultType="com.markbro.dzd.sys.sysUser.bean.User">
		select *
			from sys_user
		<where>
			orgid=#{orgid}
			and deleted=0
			and available=1
		</where>
	</select>

	<select id="queryUserMapByYhid" resultType="java.util.Map" parameterType="java.lang.String">
		select * from sys_user where id=#{yhid}
	</select>
</mapper>
